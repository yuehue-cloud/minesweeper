<!--
Minesweeper - single-file static webpage

How to use / deploy:
1) Save this file as `index.html`.
2) Local test: open index.html in a browser, or run `python3 -m http.server 8000` and open http://localhost:8000
3) GitHub Pages: create a new repo, add this file to the root as index.html, push to main, enable GitHub Pages -> yoursite.github.io/repo
4) Netlify / Vercel: drag-and-drop the file into the site deploy panel or connect repo and deploy. Both provide HTTPS automatically.

Features:
- Classic Minesweeper logic (first-click safe)
- Left click to reveal, Right click (or 'Flag' toggle) to place flag
- Difficulty presets and custom size
- Timer and mine counter
- Responsive layout and keyboard accessibility

You can edit the colors and sizes in the <style> block.
-->

<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>æ‰«é›· - é™æ€ç½‘é¡µç¤ºä¾‹</title>
<style>
:root{
  --bg:#0f1724; --panel:#0b1220; --cell:#b8c1cc; --cell-face:#e6eef6; --flag:#d33; --mine:#111; --accent:#2dd4bf;
}
*{box-sizing:border-box;font-family:system-ui,Segoe UI,Roboto,'Noto Sans SC',sans-serif}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#07101a);color:#e6eef6}
.container{max-width:980px;margin:28px auto;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
.header{display:flex;gap:12px;align-items:center;justify-content:space-between}
.title{font-size:20px;font-weight:600}
.controls{display:flex;gap:10px;align-items:center}
.select, .btn, .input{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:var(--cell-face)}
.btn{cursor:pointer}
.btn:active{transform:translateY(1px)}
.info{display:flex;gap:12px;align-items:center}
.board-wrap{display:flex;gap:18px;margin-top:16px;flex-wrap:wrap}
.panel{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px}
.grid{display:grid;border-radius:6px;overflow:hidden;background:linear-gradient(180deg,#0c1622,#08111a)}
.cell{width:36px;height:36px;display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.04);font-weight:700;user-select:none;font-size:16px;cursor:pointer}
.cell.covered{background:linear-gradient(180deg,#9fb0c6,#7f8fa0);color:var(--cell)}
.cell.revealed{background:linear-gradient(180deg,#eaf3fb,#d7e9f6);color:#0b1220}
.cell.flag{background:linear-gradient(180deg,#ffe9e9,#ffdede);color:var(--flag)}
.cell.mine{background:linear-gradient(180deg,#ffefef,#ffdede);color:var(--mine)}
.footer{margin-top:12px;display:flex;align-items:center;justify-content:space-between;gap:8px}
.small{font-size:13px;color:rgba(230,238,246,0.8)}
.controls .input{width:64px;text-align:center}
@media (max-width:520px){.cell{width:28px;height:28px;font-size:13px}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <div class="title">æ‰«é›· (Minesweeper)</div>
      <div class="small">å·¦å‡»ç¿»å¼€ï¼Œå³å‡»æˆ–â€œæ ‡è®°â€æ¨¡å¼æ ‡æ——ã€‚é¦–å‡»å®‰å…¨ã€‚</div>
    </div>
    <div class="controls">
      <select id="preset" class="select" title="é€‰æ‹©éš¾åº¦">
        <option value="easy">ç®€å• (9Ã—9, 10 é›·)</option>
        <option value="medium" selected>ä¸­ç­‰ (16Ã—16, 40 é›·)</option>
        <option value="hard">å›°éš¾ (16Ã—30, 99 é›·)</option>
        <option value="custom">è‡ªå®šä¹‰</option>
      </select>
      <input id="rows" class="input" type="number" min="5" max="30" value="16" title="è¡Œæ•°">
      <input id="cols" class="input" type="number" min="5" max="60" value="16" title="åˆ—æ•°">
      <input id="mines" class="input" type="number" min="1" value="40" title="åœ°é›·æ•°">
      <button id="newBtn" class="btn">æ–°æ¸¸æˆ</button>
      <button id="flagMode" class="btn">æ ‡è®°æ¨¡å¼: å…³</button>
    </div>
  </div>

  <div class="board-wrap">
    <div class="panel">
      <div style="display:flex;gap:12px;align-items:center;margin-bottom:10px">
        <div class="info panel" style="padding:10px;border-radius:8px">â›³ åœ°é›·: <span id="mineCount">40</span></div>
        <div class="info panel" style="padding:10px;border-radius:8px">â±ï¸ æ—¶é—´: <span id="timer">0</span>s</div>
        <div class="info panel" style="padding:10px;border-radius:8px">çŠ¶æ€: <span id="status">ç­‰å¾…é¦–å‡»</span></div>
      </div>
      <div id="grid" class="grid" aria-label="æ¸¸æˆé¢æ¿"></div>
      <div class="footer">
        <div class="small">æç¤ºï¼šåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¯åˆ‡æ¢â€œæ ‡è®°æ¨¡å¼â€æ¥æ’æ——ã€‚</div>
        <div><button id="resetBtn" class="btn">é‡ç½®å½“å‰</button></div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  // ç®€æ´ç‰ˆæ‰«é›·å®ç°
  const gridEl = document.getElementById('grid');
  const preset = document.getElementById('preset');
  const rowsInput = document.getElementById('rows');
  const colsInput = document.getElementById('cols');
  const minesInput = document.getElementById('mines');
  const newBtn = document.getElementById('newBtn');
  const flagModeBtn = document.getElementById('flagMode');
  const mineCountEl = document.getElementById('mineCount');
  const timerEl = document.getElementById('timer');
  const statusEl = document.getElementById('status');
  const resetBtn = document.getElementById('resetBtn');

  let rows=16, cols=16, mines=40;
  let board = [];
  let firstClick=true;
  let flagged=0;
  let revealed=0;
  let timer=null, time=0;
  let flagMode=false;

  function setPreset(p){
    if(p==='easy'){rows=9;cols=9;mines=10}
    else if(p==='medium'){rows=16;cols=16;mines=40}
    else if(p==='hard'){rows=16;cols=30;mines=99}
    rowsInput.value=rows; colsInput.value=cols; minesInput.value=mines; updateMineCounter();
  }

  preset.addEventListener('change', ()=>{
    if(preset.value==='custom') return;
    setPreset(preset.value);
  });

  rowsInput.addEventListener('change', ()=>{preset.value='custom';});
  colsInput.addEventListener('change', ()=>{preset.value='custom';});
  minesInput.addEventListener('change', ()=>{preset.value='custom'; updateMineCounter();});

  function updateMineCounter(){ mineCountEl.textContent = minesInput.value; }
  updateMineCounter();

  function startTimer(){ if(timer) return; timer = setInterval(()=>{time++; timerEl.textContent=time},1000); }
  function stopTimer(){ clearInterval(timer); timer=null }

  function buildBoard(){
    rows = Math.max(5, Math.min(30, parseInt(rowsInput.value)||16));
    cols = Math.max(5, Math.min(60, parseInt(colsInput.value)||16));
    mines = Math.max(1, Math.min(rows*cols-1, parseInt(minesInput.value)||40));
    board = Array(rows).fill(0).map(()=>Array(cols).fill(null));
    firstClick=true; flagged=0; revealed=0; time=0; timerEl.textContent=0; stopTimer(); statusEl.textContent='ç­‰å¾…é¦–å‡»';
    mineCountEl.textContent = mines;
    renderGrid();
  }

  function renderGrid(){
    gridEl.innerHTML='';
    gridEl.style.gridTemplateColumns = `repeat(${cols}, minmax(0,1fr))`;
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const cell = document.createElement('div');
        cell.className='cell covered';
        cell.dataset.r=r; cell.dataset.c=c; cell.tabIndex=0;
        cell.addEventListener('click', onCellLeft);
        cell.addEventListener('contextmenu', onCellRight);
        cell.addEventListener('keydown', e=>{ if(e.key==='Enter') onCellLeft(e); if(e.key==='f') toggleFlagFromKey(e); });
        // mobile long-press to flag
        let pressTimer=null;
        cell.addEventListener('touchstart', (ev)=>{ ev.preventDefault(); pressTimer=setTimeout(()=>{handleFlag(r,c)},500)});
        cell.addEventListener('touchend', ()=>{ if(pressTimer) clearTimeout(pressTimer)});
        gridEl.appendChild(cell);
      }
    }
  }

  function placeMinesAvoid(r0,c0){
    // place mines after first click to ensure first click safe
    let choices=[];
    for(let r=0;r<rows;r++) for(let c=0;c<cols;c++){
      if(Math.abs(r-r0)<=1 && Math.abs(c-c0)<=1) continue; // avoid first cell and neighbors optionally
      choices.push([r,c]);
    }
    // shuffle and pick mines
    for(let i=choices.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [choices[i],choices[j]]=[choices[j],choices[i]] }
    for(let i=0;i<mines;i++){ const [r,c]=choices[i]; board[r][c] = {mine:true,adj:0,flag:false,revealed:false} }
    // fill others
    for(let r=0;r<rows;r++) for(let c=0;c<cols;c++){
      if(!board[r][c]) board[r][c] = {mine:false,adj:0,flag:false,revealed:false};
    }
    // compute adj
    for(let r=0;r<rows;r++) for(let c=0;c<cols;c++){
      if(board[r][c].mine) continue;
      let cnt=0;
      for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){
        const nr=r+dr,nc=c+dc; if(nr<0||nc<0||nr>=rows||nc>=cols) continue; if(board[nr][nc].mine) cnt++;
      }
      board[r][c].adj=cnt;
    }
  }

  function onCellLeft(e){
    const el = e.currentTarget; const r=+el.dataset.r; const c=+el.dataset.c;
    if(flagMode){ handleFlag(r,c); return }
    if(firstClick){ placeMinesAvoid(r,c); firstClick=false; startTimer(); statusEl.textContent='è¿›è¡Œä¸­'; }
    revealCell(r,c);
  }

  function onCellRight(e){ e.preventDefault(); const el=e.currentTarget; const r=+el.dataset.r; const c=+el.dataset.c; handleFlag(r,c); }
  function toggleFlagFromKey(e){ const el=e.currentTarget; const r=+el.dataset.r; const c=+el.dataset.c; handleFlag(r,c); }

  function handleFlag(r,c){ const cell=board[r][c]; if(cell.revealed) return; cell.flag = !cell.flag; updateCellEl(r,c); flagged += cell.flag?1:-1; mineCountEl.textContent = Math.max(0, mines - flagged); }

  function revealCell(r,c){ const cell = board[r][c]; if(cell.revealed || cell.flag) return; cell.revealed=true; revealed++; updateCellEl(r,c);
    if(cell.mine){ gameOver(false); return }
    if(cell.adj===0){ // flood fill
      for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){
        const nr=r+dr,nc=c+dc; if(nr<0||nc<0||nr>=rows||nc>=cols) continue; if(!board[nr][nc].revealed) revealCell(nr,nc);
      }
    }
    checkWin();
  }

  function updateCellEl(r,c){ const idx=r*cols+c; const el = gridEl.children[idx]; const cell=board[r][c]; el.className='cell'; if(!cell.revealed) el.classList.add('covered'); else el.classList.add('revealed');
    if(cell.revealed){ el.classList.remove('flag'); if(cell.mine){ el.classList.add('mine'); el.textContent='ğŸ’£' } else { el.textContent = cell.adj?cell.adj:'' } }
    else { el.textContent=''; if(cell.flag){ el.classList.add('flag'); el.textContent='ğŸš©' } }
  }

  function revealAllMines(){ for(let r=0;r<rows;r++) for(let c=0;c<cols;c++) if(board[r][c].mine) board[r][c].revealed=true; renderAll(); }
  function renderAll(){ for(let r=0;r<rows;r++) for(let c=0;c<cols;c++) updateCellEl(r,c); }

  function checkWin(){ if(revealed === rows*cols - mines){ gameOver(true) } }

  function gameOver(win){ stopTimer(); firstClick=true; if(!win){ statusEl.textContent='å¤±è´¥ - æ¸¸æˆç»“æŸ'; revealAllMines(); } else { statusEl.textContent='èƒœåˆ©ï¼'; }
  }

  newBtn.addEventListener('click', ()=>{ buildBoard(); });
  resetBtn.addEventListener('click', ()=>{ buildBoard(); });
  flagModeBtn.addEventListener('click', ()=>{ flagMode=!flagMode; flagModeBtn.textContent = 'æ ‡è®°æ¨¡å¼: ' + (flagMode? 'å¼€':'å…³') });

  // initial
  buildBoard();

  // accessibility: prevent context menu on grid
  gridEl.addEventListener('contextmenu', e=>{ e.preventDefault(); });

})();
</script>
</body>
</html>
